# virtio-serial RPC ä½¿ç”¨æ‰‹å†Œ

## ç›®å½•

- [ç®€ä»‹](#ç®€ä»‹)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [éƒ¨ç½²å®‰è£…](#éƒ¨ç½²å®‰è£…)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å‘½ä»¤è¡Œå·¥å…·](#å‘½ä»¤è¡Œå·¥å…·)
- [API å‚è€ƒ](#api-å‚è€ƒ)
- [ç¼–ç¨‹æ¥å£](#ç¼–ç¨‹æ¥å£)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç®€ä»‹

virtio-serial RPC æ˜¯ä¸€ä¸ªåŸºäº KVM virtio-serial é€šé“çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ç³»ç»Ÿï¼Œå…è®¸å®¿ä¸»æœºï¼ˆHostï¼‰ä¸è™šæ‹Ÿæœºï¼ˆGuestï¼‰ä¹‹é—´è¿›è¡Œé«˜æ•ˆã€å®‰å…¨çš„é€šä¿¡ï¼Œæ— éœ€ç½‘ç»œè¿æ¥ã€‚

### ä¸»è¦ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| ğŸš€ é«˜æ€§èƒ½ | åŸºäº virtio åŠè™šæ‹ŸåŒ–ï¼Œä¼ è¾“é€Ÿåº¦å¯è¾¾ 30+ MB/s |
| ğŸ”’ å®‰å…¨éš”ç¦» | ä¸ä¾èµ–ç½‘ç»œï¼Œå¤©ç„¶ç½‘ç»œéš”ç¦» |
| ğŸ“ æ–‡ä»¶ä¼ è¾“ | æ”¯æŒå¤§æ–‡ä»¶åˆ†å—ä¸Šä¼ /ä¸‹è½½ï¼Œè‡ªåŠ¨ MD5 æ ¡éªŒ |
| ğŸ–¥ï¸ å‘½ä»¤æ‰§è¡Œ | åœ¨ Guest ä¸­è¿œç¨‹æ‰§è¡Œ Shell å‘½ä»¤ |
| âš™ï¸ æœåŠ¡ç®¡ç† | è¿œç¨‹æ§åˆ¶ Guest ä¸­çš„ systemd æœåŠ¡ |
| ğŸ“Š ç³»ç»Ÿç›‘æ§ | è·å– Guest ç³»ç»Ÿä¿¡æ¯å’Œèµ„æºçŠ¶æ€ |

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Host (å®¿ä¸»æœº)  â”‚                    â”‚  Guest (è™šæ‹Ÿæœº)  â”‚
â”‚                 â”‚                    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   virtio-serial    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚  Server   â”‚  â”‚
â”‚  â”‚  (CLI)    â”‚  â”‚   HTTP/1.1 åè®®     â”‚  â”‚  (å®ˆæŠ¤)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                    â”‚                 â”‚
â”‚  UNIX Socket    â”‚                    â”‚  å­—ç¬¦è®¾å¤‡       â”‚
â”‚  /var/lib/...   â”‚                    â”‚  /dev/virtio..  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- **Host**: Linux ç³»ç»Ÿï¼Œè¿è¡Œ QEMU/KVM
- **Guest**: Linux ç³»ç»Ÿï¼ŒPython >= 3.8
- virtio-serial è®¾å¤‡å·²é…ç½®

### 2. ä¸€åˆ†é’Ÿéƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd virtio-serial-RPC

# éƒ¨ç½²åˆ°è¿œç«¯
./deploy.sh
```

### 3. åŸºæœ¬ä½¿ç”¨

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆé¿å…æ¯æ¬¡è¾“å…¥é•¿è·¯å¾„ï¼‰
export VIRTIO_SOCKET='/var/lib/libvirt/qemu/channel/target/domain-XX-vmname/test.vserial.0'

# å¿ƒè·³æ£€æµ‹
python3 -m host ping

# è·å– Guest ç³»ç»Ÿä¿¡æ¯
python3 -m host info

# æ‰§è¡Œå‘½ä»¤
python3 -m host exec "ls -la /tmp"

# ä¸Šä¼ æ–‡ä»¶
python3 -m host upload local.txt /tmp/remote.txt

# ä¸‹è½½æ–‡ä»¶
python3 -m host download /tmp/remote.txt local.txt
```

---

## éƒ¨ç½²å®‰è£…

### Guest ç«¯éƒ¨ç½²

1. **å¤åˆ¶æ–‡ä»¶åˆ° Guest**

```bash
# åˆ›å»ºç›®å½•
ssh root@<guest-ip> "mkdir -p /opt/virtio-rpc"

# å¤åˆ¶ä»£ç 
scp -r common guest requirements.txt root@<guest-ip>:/opt/virtio-rpc/
```

2. **å®‰è£…ä¾èµ–**

```bash
ssh root@<guest-ip> "pip3 install pyyaml psutil"
```

3. **å¯åŠ¨æœåŠ¡**

```bash
# å‰å°è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
ssh root@<guest-ip> "cd /opt/virtio-rpc && python3 -m guest"

# åå°è¿è¡Œ
ssh -f root@<guest-ip> "cd /opt/virtio-rpc && python3 -m guest > /tmp/virtio-rpc.log 2>&1"
```

4. **è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰**

åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ `/etc/systemd/system/virtio-rpc.service`ï¼š

```ini
[Unit]
Description=VirtioRPC Guest Server
After=network.target

[Service]
Type=simple
WorkingDirectory=/opt/virtio-rpc
ExecStart=/usr/bin/python3 -m guest
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š
```bash
systemctl daemon-reload
systemctl enable virtio-rpc
systemctl start virtio-rpc
```

### Host ç«¯éƒ¨ç½²

1. **å¤åˆ¶æ–‡ä»¶åˆ° Host**

```bash
scp -r common host requirements.txt root@<host-ip>:/opt/virtio-rpc/
```

2. **å®‰è£…ä¾èµ–**

```bash
ssh root@<host-ip> "pip3 install pyyaml"
```

3. **é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

```bash
# æ·»åŠ åˆ° ~/.bashrc
echo 'export VIRTIO_SOCKET="/var/lib/libvirt/qemu/channel/target/domain-XX-vmname/test.vserial.0"' >> ~/.bashrc
source ~/.bashrc
```

---

## é…ç½®è¯´æ˜

### Guest é…ç½® (`guest/config.yaml`)

```yaml
# è®¾å¤‡é…ç½®
device:
  path: /dev/virtio-ports/test.vserial.0  # virtio-serial å­—ç¬¦è®¾å¤‡è·¯å¾„
  buffer_size: 65536                       # è¯»å–ç¼“å†²åŒºå¤§å°

# æœåŠ¡å™¨é…ç½®
server:
  max_request_size: 10485760  # æœ€å¤§è¯·æ±‚å¤§å° (10MB)
  request_timeout: 60         # è¯·æ±‚è¶…æ—¶æ—¶é—´ (ç§’)

# å®‰å…¨é…ç½®
security:
  enable_auth: false          # æ˜¯å¦å¯ç”¨è®¤è¯
  
  # å…è®¸æ‰§è¡Œçš„å‘½ä»¤ç™½åå•
  # ç©ºåˆ—è¡¨ä½¿ç”¨é»˜è®¤ç™½åå•: ls, cat, df, free, ps, etc.
  # è®¾ç½®ä¸º null å…è®¸æ‰€æœ‰å‘½ä»¤ï¼ˆå±é™©ï¼ï¼‰
  allowed_commands: []
  
  # å…è®¸è®¿é—®çš„æ–‡ä»¶è·¯å¾„å‰ç¼€
  allowed_paths:
    - /tmp/
    - /var/log/
    - /home/
    - /opt/

# æ—¥å¿—é…ç½®
logging:
  level: INFO                 # æ—¥å¿—çº§åˆ«: DEBUG, INFO, WARNING, ERROR
  # file: /var/log/virtio-rpc.log  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

### Host é…ç½® (`host/config.yaml`)

```yaml
# è¿æ¥é…ç½®
connection:
  socket_path: /var/lib/libvirt/qemu/channel/target/domain-XX/test.vserial.0
  connect_timeout: 5.0    # è¿æ¥è¶…æ—¶ (ç§’)
  read_timeout: 30.0      # è¯»å–è¶…æ—¶ (ç§’)
  write_timeout: 30.0     # å†™å…¥è¶…æ—¶ (ç§’)

# é‡è¯•é…ç½®
retry:
  max_retries: 3          # æœ€å¤§é‡è¯•æ¬¡æ•°
  retry_interval: 1.0     # é‡è¯•é—´éš” (ç§’)
  backoff_factor: 2.0     # é€€é¿å› å­
```

---

## å‘½ä»¤è¡Œå·¥å…·

### é€šç”¨é€‰é¡¹

```bash
python3 -m host [é€‰é¡¹] <å‘½ä»¤> [å‘½ä»¤å‚æ•°]

é€‰é¡¹:
  -s, --socket PATH     UNIX åŸŸå¥—æ¥å­—è·¯å¾„ (æˆ–è®¾ç½® VIRTIO_SOCKET ç¯å¢ƒå˜é‡)
  -c, --config FILE     é…ç½®æ–‡ä»¶è·¯å¾„
  -d, --debug           å¯ç”¨è°ƒè¯•è¾“å‡º
  -r, --raw             è¾“å‡ºåŸå§‹ JSON æ ¼å¼
  -t, --timeout SEC     é»˜è®¤è¶…æ—¶æ—¶é—´ (ç§’)
  -h, --help            æ˜¾ç¤ºå¸®åŠ©
```

### å‘½ä»¤è¯¦è§£

#### ping - å¿ƒè·³æ£€æµ‹

```bash
python3 -m host ping
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
{
  "timestamp": 1735312345,
  "uptime": 3600,
  "message": "pong"
}
```

#### info - ç³»ç»Ÿä¿¡æ¯

```bash
python3 -m host info
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
{
  "hostname": "guest-vm",
  "os": "Linux",
  "os_version": "CentOS 8.6",
  "kernel": "4.19.90-20.x86_64",
  "arch": "x86_64",
  "cpu_count": 4,
  "memory_total": 8589934592,
  "memory_available": 6442450944,
  "python_version": "3.9.7"
}
```

#### status - ç³»ç»ŸçŠ¶æ€

```bash
python3 -m host status
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
{
  "cpu_usage": 15.2,
  "memory_usage": 45.8,
  "disk_usage": {
    "/": 32.1,
    "/var": 15.6
  },
  "load_average": [0.52, 0.48, 0.45],
  "process_count": 128
}
```

#### exec - æ‰§è¡Œå‘½ä»¤

```bash
python3 -m host exec "å‘½ä»¤" [é€‰é¡¹]

é€‰é¡¹:
  --timeout SEC    å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é—´ (é»˜è®¤ 30 ç§’)
  -w, --workdir    å·¥ä½œç›®å½•
```

ç¤ºä¾‹ï¼š
```bash
# æŸ¥çœ‹ç›®å½•
python3 -m host exec "ls -la /tmp"

# æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
python3 -m host exec "cat /etc/os-release"

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
python3 -m host exec "df -h"

# æŒ‡å®šè¶…æ—¶æ—¶é—´
python3 -m host exec "sleep 5 && echo done" --timeout 10
```

> âš ï¸ **æ³¨æ„**: åªèƒ½æ‰§è¡Œç™½åå•å†…çš„å‘½ä»¤ï¼Œé»˜è®¤ç™½åå•åŒ…æ‹¬: ls, cat, echo, head, tail, grep, find, wc, df, du, free, top, ps, uptime, date, hostname, uname, whoami, id, pwd, env, which, file, stat, md5sum, sha256sum, ip, ss, netstat, ping, systemctl, journalctl

#### upload - ä¸Šä¼ æ–‡ä»¶

```bash
python3 -m host upload <æœ¬åœ°æ–‡ä»¶> <è¿œç¨‹è·¯å¾„> [é€‰é¡¹]

é€‰é¡¹:
  -m, --mode MODE       æ–‡ä»¶æƒé™ (é»˜è®¤ 0644)
  --no-overwrite        ä¸è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
  --chunk-size SIZE     åˆ†å—å¤§å° (é»˜è®¤ 2MB)
```

ç¤ºä¾‹ï¼š
```bash
# æ™®é€šä¸Šä¼ 
python3 -m host upload config.txt /tmp/config.txt

# è®¾ç½®æ‰§è¡Œæƒé™
python3 -m host upload script.sh /tmp/script.sh -m 0755

# ä¸Šä¼ å¤§æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ†å—ï¼‰
python3 -m host upload large_file.tar.gz /tmp/large_file.tar.gz
```

è¾“å‡ºç¤ºä¾‹ï¼ˆå¤§æ–‡ä»¶ï¼‰ï¼š
```
Large file detected (104857600 bytes), using chunked upload...
[==============================] 100% (104857600/104857600 bytes)
Upload successful: /tmp/large_file.tar.gz (104857600 bytes)
MD5: e237b72464cdfaf4585e932c94156e73
```

#### download - ä¸‹è½½æ–‡ä»¶

```bash
python3 -m host download <è¿œç¨‹è·¯å¾„> <æœ¬åœ°æ–‡ä»¶> [é€‰é¡¹]

é€‰é¡¹:
  --chunk-size SIZE     åˆ†å—å¤§å° (é»˜è®¤ 2MB)
```

ç¤ºä¾‹ï¼š
```bash
# æ™®é€šä¸‹è½½
python3 -m host download /var/log/messages ./messages.log

# ä¸‹è½½å¤§æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ†å—ï¼‰
python3 -m host download /tmp/backup.tar.gz ./backup.tar.gz
```

#### file-info - æ–‡ä»¶ä¿¡æ¯

```bash
python3 -m host file-info <è·¯å¾„>
```

ç¤ºä¾‹ï¼š
```bash
python3 -m host file-info /etc/hosts
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
{
  "path": "/etc/hosts",
  "exists": true,
  "type": "file",
  "size": 158,
  "mode": "0644",
  "owner": "root",
  "group": "root",
  "mtime": 1735312345,
  "md5": "abc123..."
}
```

#### service - æœåŠ¡ç®¡ç†

```bash
python3 -m host service <æœåŠ¡å> <æ“ä½œ>

æ“ä½œ:
  status    æŸ¥çœ‹æœåŠ¡çŠ¶æ€
  start     å¯åŠ¨æœåŠ¡
  stop      åœæ­¢æœåŠ¡
  restart   é‡å¯æœåŠ¡
  enable    è®¾ç½®å¼€æœºè‡ªå¯
  disable   å–æ¶ˆå¼€æœºè‡ªå¯
```

ç¤ºä¾‹ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
python3 -m host service nginx status

# é‡å¯æœåŠ¡
python3 -m host service nginx restart

# è®¾ç½®å¼€æœºè‡ªå¯
python3 -m host service nginx enable
```

---

## API å‚è€ƒ

### ç³»ç»Ÿç±» API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/ping` | å¿ƒè·³æ£€æµ‹ |
| GET | `/api/v1/system/info` | è·å–ç³»ç»Ÿä¿¡æ¯ |
| GET | `/api/v1/system/status` | è·å–ç³»ç»ŸçŠ¶æ€ |

### å‘½ä»¤æ‰§è¡Œ API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/shell/exec` | æ‰§è¡Œ Shell å‘½ä»¤ |

è¯·æ±‚ä½“ï¼š
```json
{
  "command": "ls -la /tmp",
  "timeout": 30,
  "working_dir": "/tmp",
  "env": {"KEY": "value"}
}
```

### æ–‡ä»¶æ“ä½œ API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/file/upload` | ä¸Šä¼ æ–‡ä»¶ï¼ˆå°æ–‡ä»¶ï¼‰ |
| POST | `/api/v1/file/download` | ä¸‹è½½æ–‡ä»¶ï¼ˆå°æ–‡ä»¶ï¼‰ |
| GET | `/api/v1/file/info?path=xxx` | æŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯ |

### åˆ†å—ä¼ è¾“ API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/file/chunked/upload/init` | åˆå§‹åŒ–åˆ†å—ä¸Šä¼  |
| POST | `/api/v1/file/chunked/upload/chunk` | ä¸Šä¼ åˆ†å— |
| POST | `/api/v1/file/chunked/upload/finish` | å®Œæˆä¸Šä¼  |
| POST | `/api/v1/file/chunked/upload/abort` | å–æ¶ˆä¸Šä¼  |
| POST | `/api/v1/file/chunked/download` | åˆ†å—ä¸‹è½½ |

### æœåŠ¡ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/service/control` | æ§åˆ¶æœåŠ¡ |

è¯·æ±‚ä½“ï¼š
```json
{
  "name": "nginx",
  "action": "restart"
}
```

---

## ç¼–ç¨‹æ¥å£

### Python å®¢æˆ·ç«¯ç¤ºä¾‹

```python
from host.client import VirtioRPCClient

# åˆ›å»ºå®¢æˆ·ç«¯ï¼ˆä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨è‡ªåŠ¨ç®¡ç†è¿æ¥ï¼‰
socket_path = "/var/lib/libvirt/qemu/channel/target/domain-XX/test.vserial.0"

with VirtioRPCClient(socket_path) as client:
    # å¿ƒè·³æ£€æµ‹
    result = client.ping()
    print(f"æœåŠ¡å™¨å“åº”: {result}")
    
    # è·å–ç³»ç»Ÿä¿¡æ¯
    info = client.get_system_info()
    print(f"ä¸»æœºå: {info['data']['hostname']}")
    
    # æ‰§è¡Œå‘½ä»¤
    result = client.exec_command("df -h", timeout=10)
    print(result['data']['stdout'])
    
    # ä¸Šä¼ æ–‡ä»¶ï¼ˆå°æ–‡ä»¶ï¼‰
    result = client.upload_file("local.txt", "/tmp/remote.txt")
    print(f"ä¸Šä¼ æˆåŠŸ: {result['data']['path']}")
    
    # ä¸Šä¼ å¤§æ–‡ä»¶ï¼ˆåˆ†å—ï¼‰
    def progress(uploaded, total):
        print(f"\rè¿›åº¦: {uploaded}/{total}", end='')
    
    result = client.chunked_upload_file(
        "large_file.bin", 
        "/tmp/large_file.bin",
        progress_callback=progress
    )
    print(f"\nMD5: {result['data']['md5']}")
    
    # ä¸‹è½½æ–‡ä»¶
    result = client.download_file("/tmp/remote.txt", "downloaded.txt")
    
    # æœåŠ¡ç®¡ç†
    result = client.control_service("nginx", "status")
    print(f"æœåŠ¡çŠ¶æ€: {result['data']['status']}")
```

### æ‰‹åŠ¨ç®¡ç†è¿æ¥

```python
from host.client import VirtioRPCClient

client = VirtioRPCClient(socket_path)

try:
    # å»ºç«‹è¿æ¥
    client.connect()
    
    # å‘é€è¯·æ±‚
    result = client.ping()
    
finally:
    # æ–­å¼€è¿æ¥
    client.disconnect()
```

---

## å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥

**é—®é¢˜**: `Connection refused` æˆ– `No such file or directory`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ Guest æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`ps aux | grep 'python3 -m guest'`
- æ£€æŸ¥ virtio-serial è®¾å¤‡æ˜¯å¦å­˜åœ¨ï¼š
  - Host: `ls -la /var/lib/libvirt/qemu/channel/target/domain-XX/`
  - Guest: `ls -la /dev/virtio-ports/`
- ç¡®è®¤ QEMU å¯åŠ¨å‚æ•°åŒ…å« virtio-serial é…ç½®

### 2. å‘½ä»¤æ‰§è¡Œè¢«æ‹’ç»

**é—®é¢˜**: `Command not allowed: xxx`

**è§£å†³æ–¹æ¡ˆ**:
- è¯¥å‘½ä»¤ä¸åœ¨ç™½åå•å†…ï¼Œä¿®æ”¹ `guest/config.yaml` æ·»åŠ åˆ° `allowed_commands`
- æˆ–è®¾ç½® `allowed_commands: null` å…è®¸æ‰€æœ‰å‘½ä»¤ï¼ˆä¸æ¨èï¼‰

### 3. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**é—®é¢˜**: `Path not in allowed list`

**è§£å†³æ–¹æ¡ˆ**:
- ç›®æ ‡è·¯å¾„ä¸åœ¨å…è®¸åˆ—è¡¨å†…ï¼Œä¿®æ”¹ `guest/config.yaml` çš„ `allowed_paths`

### 4. å¤§æ–‡ä»¶ä¼ è¾“è¶…æ—¶

**é—®é¢˜**: ä¼ è¾“å¤§æ–‡ä»¶æ—¶è¿æ¥è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
- æ–‡ä»¶ä¼šè‡ªåŠ¨ä½¿ç”¨åˆ†å—ä¼ è¾“ï¼ˆ>2MBï¼‰
- å¯é€šè¿‡ `--chunk-size` è°ƒæ•´åˆ†å—å¤§å°
- å¢åŠ è¶…æ—¶æ—¶é—´ï¼š`-t 120`

### 5. æŸ¥æ‰¾ UNIX Socket è·¯å¾„

```bash
# é€šè¿‡è™šæ‹Ÿæœºåç§°æŸ¥æ‰¾
virsh dominfo <vm-name> | grep Id
ls /var/lib/libvirt/qemu/channel/target/domain-<id>-*/

# æˆ–ç›´æ¥åˆ—å‡ºæ‰€æœ‰
find /var/lib/libvirt/qemu/channel/target -name "*.vserial.*"
```

### 6. ä¾èµ–å®‰è£…ï¼ˆæ— ç½‘ç»œç¯å¢ƒï¼‰

å¦‚æœè¿œç«¯æ— æ³•è®¿é—®å¤–ç½‘ï¼š

```bash
# æ–¹æ³•1: SSH åå‘ä»£ç†
ssh -R 7890:127.0.0.1:7890 root@<remote-ip>
# åœ¨è¿œç«¯è®¾ç½®ä»£ç†
export https_proxy=http://127.0.0.1:7890
pip3 install pyyaml

# æ–¹æ³•2: æœ¬åœ°ä¸‹è½½åä¸Šä¼ 
pip download pyyaml -d ./packages/
scp -r ./packages root@<remote-ip>:/tmp/
ssh root@<remote-ip> "pip3 install --no-index --find-links=/tmp/packages pyyaml"
```

---

## æ€§èƒ½å‚è€ƒ

| æ“ä½œ | æ–‡ä»¶å¤§å° | è€—æ—¶ | é€Ÿåº¦ |
|------|---------|------|------|
| å°æ–‡ä»¶ä¸Šä¼  | 5 MB | 0.65s | ~7.7 MB/s |
| å°æ–‡ä»¶ä¸‹è½½ | 5 MB | 0.28s | ~17.8 MB/s |
| åˆ†å—ä¸Šä¼  | 100 MB | 6.5s | ~15.4 MB/s |
| åˆ†å—ä¸‹è½½ | 100 MB | 2.6s | ~38.5 MB/s |

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0.0 | 2025-12-27 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬ RPC åŠŸèƒ½ |
| 1.1.0 | 2025-12-27 | æ–°å¢åˆ†å—ä¸Šä¼ /ä¸‹è½½ï¼Œæ”¯æŒå¤§æ–‡ä»¶ä¼ è¾“ |

---

## è®¸å¯è¯

MIT License
